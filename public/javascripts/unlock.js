/*! For license information please see unlock.latest.min.js.LICENSE.txt */
!function(){"use strict";var t={566:function(t,e,n){var o=n(15),r=n.n(o),a=n(645),i=n.n(a)()(r());i.push([t.id,".unlock-protocol-checkout {\n  display: none;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100vh;\n  border: 0;\n  z-index: -2147483647;\n}\n\n.unlock-protocol-checkout.show {\n  display: block;\n  z-index: 2147483647;\n}\n","",{version:3,sources:["webpack://./src/paywall-script/iframe.css"],names:[],mappings:"AAAA;EACE,aAAa;EACb,eAAe;EACf,MAAM;EACN,OAAO;EACP,WAAW;EACX,aAAa;EACb,SAAS;EACT,oBAAoB;AACtB;;AAEA;EACE,cAAc;EACd,mBAAmB;AACrB",sourcesContent:[".unlock-protocol-checkout {\n  display: none;\n  position: fixed;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100vh;\n  border: 0;\n  z-index: -2147483647;\n}\n\n.unlock-protocol-checkout.show {\n  display: block;\n  z-index: 2147483647;\n}\n"],sourceRoot:""}]),e.Z=i},645:function(t){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=t(e);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,o){"string"==typeof t&&(t=[[null,t,""]]);var r={};if(o)for(var a=0;a<this.length;a++){var i=this[a][0];null!=i&&(r[i]=!0)}for(var s=0;s<t.length;s++){var c=[].concat(t[s]);o&&r[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),e.push(c))}},e}},15:function(t){function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}t.exports=function(t){var n,o,r=(o=4,function(t){if(Array.isArray(t))return t}(n=t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],o=!0,r=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!e||n.length!==e);o=!0);}catch(t){r=!0,a=t}finally{try{o||null==s.return||s.return()}finally{if(r)throw a}}return n}}(n,o)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?e(t,n):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=r[1],i=r[3];if("function"==typeof btoa){var s=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(s),l="/*# ".concat(c," */"),d=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[a].concat(d).concat([l]).join("\n")}return[a].join("\n")}},379:function(t,e,n){var o,r=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),a=[];function i(t){for(var e=-1,n=0;n<a.length;n++)if(a[n].identifier===t){e=n;break}return e}function s(t,e){for(var n={},o=[],r=0;r<t.length;r++){var s=t[r],c=e.base?s[0]+e.base:s[0],l=n[c]||0,d="".concat(c," ").concat(l);n[c]=l+1;var h=i(d),u={css:s[1],media:s[2],sourceMap:s[3]};-1!==h?(a[h].references++,a[h].updater(u)):a.push({identifier:d,updater:m(u,e),references:1}),o.push(d)}return o}function c(t){var e=document.createElement("style"),o=t.attributes||{};if(void 0===o.nonce){var a=n.nc;a&&(o.nonce=a)}if(Object.keys(o).forEach((function(t){e.setAttribute(t,o[t])})),"function"==typeof t.insert)t.insert(e);else{var i=r(t.insert||"head");if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(e)}return e}var l,d=(l=[],function(t,e){return l[t]=e,l.filter(Boolean).join("\n")});function h(t,e,n,o){var r=n?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(t.styleSheet)t.styleSheet.cssText=d(e,r);else{var a=document.createTextNode(r),i=t.childNodes;i[e]&&t.removeChild(i[e]),i.length?t.insertBefore(a,i[e]):t.appendChild(a)}}function u(t,e,n){var o=n.css,r=n.media,a=n.sourceMap;if(r?t.setAttribute("media",r):t.removeAttribute("media"),a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleSheet)t.styleSheet.cssText=o;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(o))}}var p=null,f=0;function m(t,e){var n,o,r;if(e.singleton){var a=f++;n=p||(p=c(e)),o=h.bind(null,n,a,!1),r=h.bind(null,n,a,!0)}else n=c(e),o=u.bind(null,n,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return o(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;o(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=(void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o));var n=s(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var o=0;o<n.length;o++){var r=i(n[o]);a[r].references--}for(var c=s(t,e),l=0;l<n.length;l++){var d=i(n[l]);0===a[d].references&&(a[d].updater(),a.splice(d,1))}n=c}}}}},e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={id:o,exports:{}};return t[o](r,r.exports,n),r.exports}n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){var t="application/x-postmate-v1+json",e=0,o={handshake:1,"handshake-reply":1,call:1,emit:1,reply:1,request:1},r=function(e,n){return!("string"==typeof n&&e.origin!==n||!e.data||"object"==typeof e.data&&!("postmate"in e.data)||e.data.type!==t||!o[e.data.postmate])},a=function(){function n(t){var e=this;this.parent=t.parent,this.frame=t.frame,this.child=t.child,this.childOrigin=t.childOrigin,this.events={},this.listener=function(t){if(!r(t,e.childOrigin))return!1;var n=((t||{}).data||{}).value||{},o=n.data,a=n.name;"emit"===t.data.postmate&&a in e.events&&e.events[a].call(e,o)},this.parent.addEventListener("message",this.listener,!1)}var o=n.prototype;return o.get=function(n){var o=this;return new s.Promise((function(r){var a=++e;o.parent.addEventListener("message",(function t(e){e.data.uid===a&&"reply"===e.data.postmate&&(o.parent.removeEventListener("message",t,!1),r(e.data.value))}),!1),o.child.postMessage({postmate:"request",type:t,property:n,uid:a},o.childOrigin)}))},o.call=function(e,n){this.child.postMessage({postmate:"call",type:t,property:e,data:n},this.childOrigin)},o.on=function(t,e){this.events[t]=e},o.destroy=function(){window.removeEventListener("message",this.listener,!1),this.frame.parentNode.removeChild(this.frame)},n}(),i=function(){function e(e){var n=this;this.model=e.model,this.parent=e.parent,this.parentOrigin=e.parentOrigin,this.child=e.child,this.child.addEventListener("message",(function(e){if(r(e,n.parentOrigin)){var o=e.data,a=o.property,i=o.uid,c=o.data;"call"!==e.data.postmate?function(t,e){var n="function"==typeof t[e]?t[e]():t[e];return s.Promise.resolve(n)}(n.model,a).then((function(n){return e.source.postMessage({property:a,postmate:"reply",type:t,uid:i,value:n},e.origin)})):a in n.model&&"function"==typeof n.model[a]&&n.model[a](c)}}))}return e.prototype.emit=function(e,n){this.parent.postMessage({postmate:"emit",type:t,value:{name:e,data:n}},this.parentOrigin)},e}(),s=function(){function e(t){var e=t.container,n=void 0===e?void 0!==n?n:document.body:e,o=t.model,r=t.url,a=t.name,i=t.classListArray,s=void 0===i?[]:i;return this.parent=window,this.frame=document.createElement("iframe"),this.frame.name=a||"",this.frame.classList.add.apply(this.frame.classList,s),n.appendChild(this.frame),this.child=this.frame.contentWindow||this.frame.contentDocument.parentWindow,this.model=o||{},this.sendHandshake(r)}return e.prototype.sendHandshake=function(n){var o,i=this,s=function(t){var e=document.createElement("a");e.href=t;var n=e.protocol.length>4?e.protocol:window.location.protocol,o=e.host.length?"80"===e.port||"443"===e.port?e.hostname:e.host:window.location.host;return e.origin||n+"//"+o}(n),c=0;return new e.Promise((function(e,l){i.parent.addEventListener("message",(function t(n){return!!r(n,s)&&("handshake-reply"===n.data.postmate?(clearInterval(o),i.parent.removeEventListener("message",t,!1),i.childOrigin=n.origin,e(new a(i))):l("Failed handshake"))}),!1);var d=function(){c++,i.child.postMessage({postmate:"handshake",type:t,model:i.model},s),5===c&&clearInterval(o)},h=function(){d(),o=setInterval(d,500)};i.frame.attachEvent?i.frame.attachEvent("onload",h):i.frame.onload=h,i.frame.src=n}))},e}();s.debug=!1,s.Promise=function(){try{return window?window.Promise:Promise}catch(t){return null}}(),s.Model=function(){function e(t){return this.child=window,this.model=t,this.parent=this.child.parent,this.sendHandshakeReply()}return e.prototype.sendHandshakeReply=function(){var e=this;return new s.Promise((function(n,o){e.child.addEventListener("message",(function r(a){if(a.data.postmate){if("handshake"===a.data.postmate){e.child.removeEventListener("message",r,!1),a.source.postMessage({postmate:"handshake-reply",type:t},a.origin),e.parentOrigin=a.origin;var s=a.data.model;return s&&Object.keys(s).forEach((function(t){e.model[t]=s[t]})),n(new i(e))}return o("Handshake Reply Failed")}}),!1)}))},e}();var c=s,l=n(379),d=n.n(l),h=n(566);d()(h.Z,{insert:"head",singleton:!1}),h.Z.locals;const u=(t,e)=>{let n;t===p.status&&u("unlockProtocol",e.state);try{n=new window.CustomEvent(t,{detail:e})}catch(o){n=window.document.createEvent("customevent"),n.initCustomEvent(t,!0,!0,e)}window.dispatchEvent(n)},p={status:"unlockProtocol.status",authenticated:"unlockProtocol.authenticated",transactionSent:"unlockProtocol.transactionSent"};function f(t){try{var e=t.localStorage;const n="__storage_test__";return e.setItem(n,n),e.removeItem(n),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}}const m=async(t,e,n)=>{const o={method:"eth_call",params:[{to:e,data:`0xabdf82ce000000000000000000000000${n.substring(2)}`},"latest"],id:1337,jsonrpc:"2.0"},r=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),a=(await r.json()).result;return parseInt(a,16)>Number.MAX_SAFE_INTEGER?0:parseInt(a,16)||0},y=async(t,e,n,o,r)=>{if(e&&n&&o){const a=await(async(t,e)=>{const n={method:"eth_getTransactionByHash",params:[e],id:1337,jsonrpc:"2.0"},o=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return(await o.json()).result})(t,o);return a?!a.blockNumber||await m(t,n,e)>(new Date).getTime()/1e3:!!r}return!1},v=async(t,e,n)=>{const o=`${t}/transactions?for=${e}&${n.map((t=>`recipient[]=${encodeURIComponent(t)}`)).join("&")}`,r=await fetch(o);return(await r.json()).transactions},g=t=>{const e=Date.now()-864e5;return new Date(t).getTime()>e},k=async(t,e,{readOnlyProvider:n,locksmithUri:o})=>{const r=Object.keys(e.locks);return!!(await Promise.all(r.map((e=>m(n,e,t))))).some((t=>t>(new Date).getTime()/1e3))||!(e.pessimistic||!await(async(t,e,n,o)=>{const r=(await v(e,o,n)).filter((t=>g(t.createdAt)));return(await Promise.all(r.map((e=>y(t,o,e.recipient,e.transactionHash,!1))))).reduce(((t,e)=>e||!!t),!1)})(n,o,Object.keys(e.locks),t))},w="unlock-protocol-checkout";var A;!function(t){t.userInfo="checkout.userInfo",t.closeModal="checkout.closeModal",t.transactionInfo="checkout.transactionInfo",t.methodCall="checkout.methodCall"}(A||(A={}));class b{constructor(t,e,n){this.childCallBuffer=[],this.loadCheckoutModal=()=>{this.iframe?this.showIframe():this.shakeHands()},this.getUserAccountAddress=()=>this.userAccountAddress,this.resetConfig=t=>{this.paywallConfig=((t,e)=>{const n={...t};return n.useDelegatedProvider||(n.useDelegatedProvider=!!e),n})(t,this.provider),this.checkKeysAndLock(),this.setConfig?this.setConfig(this.paywallConfig):this.childCallBuffer.push(["setConfig",this.paywallConfig])},this.getState=()=>this.lockStatus,this.cacheUserInfo=async t=>{var e;e=t,f(window)&&window.localStorage.setItem("userInfo",JSON.stringify(e))},this.loadCache=async()=>{const t=function(t){if(f(window))return JSON.parse(window.localStorage.getItem("userInfo"))}();if(!t)return this.lockPage();this.userAccountAddress=t.address,this.checkKeysAndLock()},this.checkKeysAndLock=async()=>{const{readOnlyProvider:t,locksmithUri:e}=this.networkConfigs[this.paywallConfig.network];if(this.userAccountAddress)return this.lockStatus=void 0,await k(this.userAccountAddress,this.paywallConfig,{readOnlyProvider:t,locksmithUri:e})?this.unlockPage():this.lockPage()},this.shakeHands=async()=>{const{unlockAppUrl:t}=this.networkConfigs[this.paywallConfig.network],e=await new c({url:`${t}/checkout`,classListArray:[w,"show"]});this.child=e,this.iframe=document.getElementsByClassName(w)[0],e.on(A.closeModal,this.hideIframe),e.on(A.userInfo,this.handleUserInfoEvent),e.on(A.methodCall,this.handleMethodCallEvent),e.on(A.transactionInfo,this.handleTransactionInfoEvent),this.childCallBuffer.forEach((t=>e.call(...t))),this.setConfig=t=>{e.call("setConfig",t)}},this.handleTransactionInfoEvent=async({hash:t,lock:e})=>{const{readOnlyProvider:n}=this.networkConfigs[this.paywallConfig.network];u(p.transactionSent,{hash:t,lock:e}),this.paywallConfig.pessimistic||await y(n,this.userAccountAddress,e,t,!0)&&this.unlockPage()},this.handleUserInfoEvent=async t=>{this.userAccountAddress=t.address,u(p.authenticated,t),this.cacheUserInfo(t),this.checkKeysAndLock()},this.handleMethodCallEvent=async({method:t,params:e,id:n})=>{await(async t=>{if(!t)throw new Error("Fatal: no web3 provider found.");await t.enable()})(this.provider),this.provider.sendAsync({method:t,params:e,id:n},((t,e)=>{this.child.call("resolveMethodCall",{id:n,error:t,response:e})}))},this.showIframe=()=>{this.iframe.classList.add("show")},this.hideIframe=()=>{this.iframe.classList.remove("show")},this.lockPage=()=>{this.lockStatus="locked",u(p.status,{state:this.lockStatus})},this.unlockPage=()=>{this.lockStatus="unlocked",u(p.status,{state:this.lockStatus})},this.networkConfigs=e,this.provider=n||(t=>t.ethereum?t.ethereum:t.web3?t.web3.currentProvider:void 0)(window),this.resetConfig(t),this.loadCache()}}let C;const E="https://paywall.unlock-protocol.com";C=E.match("staging-paywall.unlock-protocol.com")?"https://staging-app.unlock-protocol.com":E.match("paywall.unlock-protocol.com")?"https://app.unlock-protocol.com":"http://0.0.0.0:3000";const O={1:{readOnlyProvider:"https://eth-mainnet.alchemyapi.io/v2/b7Mxclz5hGyHqoeodGLQ17F5Qi97S7xJ",locksmithUri:"https://locksmith.unlock-protocol.com",unlockAppUrl:C},3:{readOnlyProvider:"",locksmithUri:"https://locksmith.unlock-protocol.com",unlockAppUrl:C},4:{readOnlyProvider:"https://eth-rinkeby.alchemyapi.io/v2/n0NXRSZ9olpkJUPDLBC00Es75jaqysyT",locksmithUri:"https://rinkeby.locksmith.unlock-protocol.com",unlockAppUrl:C},42:{readOnlyProvider:"",locksmithUri:"https://locksmith.unlock-protocol.com",unlockAppUrl:C},100:{readOnlyProvider:"https://rpc.xdaichain.com/",locksmithUri:"https://locksmith.unlock-protocol.com",unlockAppUrl:C},1984:{readOnlyProvider:"http://127.0.0.1:8545",locksmithUri:"http://127.0.0.1:8080",unlockAppUrl:C}},S=window.unlockProtocolConfig,P="https://paywall.unlock-protocol.com";if(S){S.network||(P.match("staging-paywall.unlock-protocol.com")?(S.network=4,console.error("Missing network in Unlock config. Assigned default to mainnet: 1. See https://docs.unlock-protocol.com/")):P.match("paywall.unlock-protocol.com")?(S.network=1,console.error("Missing network in Unlock config. Assigned default to rinkeby 4. See https://docs.unlock-protocol.com/")):console.error("Missing network in Unlock config. Please set one. See https://docs.unlock-protocol.com/"));const t=new b(S,O),{getState:e,getUserAccountAddress:n,loadCheckoutModal:o,resetConfig:r}=t;(t=>{const e={},n={writable:!1,configurable:!1,enumerable:!1},o=Object.keys(t).map((e=>({[e]:{value:t[e],...n}})));Object.defineProperties(e,Object.assign({},...o)),(Object.freeze||Object)(e);try{Object.defineProperties(window,{unlockProtocol:{value:e,...n}})}catch(t){console.warn("WARNING: unlockProtocol already defined, cannot re-define it")}})({loadCheckoutModal:o,resetConfig:r,getUserAccountAddress:n,getState:e})}else console.error("Missing window.unlockProtocolConfig. See docs on how to configure your locks: https://docs.unlock-protocol.com/")}()}();
